{% extends "base.html" %}

{% load static %}

{% block content %}

{% include "ledger/nav.html" with active="records" %}

<div class="container">
  <div class="row justify-content-center">
    <div class="col-2" id="root"></div>

    <div class="col-6">
      <table class="table table-sm mt-4">
        <thead>
          <th scope="col"></th>
          <th scope="col">Debit</th>
          <th scope="col">Credit</th>
        </thead>
        <tbody>
        {% include "ledger/record_single.html" with record=record %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="row justify-content-center">
    <div id="add_variation_form_wrapper"></div>
  </div>
  <div class="row justify-content-center">
    <button id="add_variation_btn" class="btn btn-primary">Add variation</button>
    <a class="btn btn-danger" href="{% url 'record_delete' ledger.pk record.pk %}">Delete</a>
  </div>
</div>
{% endblock %}

{% block javascript %}
<script src="{% static 'bundle.js' %}"></script>
<script>
let addVariationFormUrl = "{% url 'variation_create' ledger.pk record.pk %}";

function mountForm(text, wrapperId) {
    let formWrapper = document.getElementById(wrapperId);
    formWrapper.innerHTML = text;
}

document.addEventListener("DOMContentLoaded", function(event) {
    let createBtn = document.getElementById("add_variation_btn");
    createBtn.onclick = function (event) {
        fetch(addVariationFormUrl)
        .then(function(response) {
            console.log(response);
            return response.text();
        })
        .then(function(text) {
            mountForm(text, "add_variation_form_wrapper");
            createBtn.classList.add("invisible");
        });
    };

});
</script>
{% endblock javascript %}
